---
title: "Replication 4"
author: "Enxhi Buxheli"
date: "4/2/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(dplyr)
library(tidyverse)
library(ei) 
library(MatchIt)
library(weights)
library(simpleboot)
library(Zelig)
library(apsrtable)
```

```{r config}
# Graphics parameters to make output pretty
ylims = c(-.35,.1)
ylims.2 = c(-.45,.1)
xlims = c(.5,11)
dists = seq(from = 1000, to = 100, by = -100) ###DELETE THIS LATER
xs = seq(1:length(dists))
ys = seq(from = -.35, to = .1, by = .05)
ys.lab = c('-0.35','-0.30', '-0.25','-0.20','-0.15','-0.10','-0.05','0.00','0.05','0.10')
ys.2 = seq(from = -.45, to = .1, by = .05)
ys.lab.2 = c('-0.45','-0.40','-0.35','-0.30', '-0.25','-0.20','-0.15','-0.10','-0.05','0.00','0.05','0.10')

offsets = .15
text.offsets = .025
cex.axis = .9
cex.N = .7
top.text.adj = c(1.3,1.3) ##offsets on labels to reduce crowding
bottom.text.adj = c(-.15,-.85)
point.size = 2
line.offset = .0175
```

# Figure 1
```{r fig1}
# Reading in the necessary csv files to be used in figure 1
wtreat <- read_csv('dataverse_files/white.treat.effect.mean.boot.csv') 
wtreat.lower <- read_csv('dataverse_files/white.treat.effect.conf.boot.lower.csv') 
wtreat.upper <- read_csv('dataverse_files/white.treat.effect.conf.boot.upper.csv') 
Nwtreat <- read_csv('dataverse_files/white.treat.N.csv')
btreat <- read_csv('dataverse_files/black.treat.effect.mean.boot.csv') 
btreat.lower <- read_csv('dataverse_files/black.treat.effect.conf.boot.lower.csv') 
btreat.upper <- read_csv('dataverse_files/black.treat.effect.conf.boot.upper.csv') 
Nbtreat <- read_csv('dataverse_files/black.treat.N.csv')

# Making the read in data usable
use.wtreat  <- as.matrix(wtreat[7,])
use.wlower  <- as.matrix(wtreat.lower[7,])
use.wupper  <- as.matrix(wtreat.upper[7,])
use.Nwtreat <- as.matrix(Nwtreat[7,])
use.btreat  <- as.matrix(btreat[7,])
use.blower  <- as.matrix(btreat.lower[7,])
use.bupper  <- as.matrix(btreat.upper[7,])
use.Nbtreat <- as.matrix(Nbtreat[7,])

# Setting the parameters for the plot
par(las = 1,
    mar = c(5.1, 4.1, .5, .5), 
    cex = cex.N)
plot(xs, use.wtreat,
    ylim = ylims,
    xlim = xlims,
    type = 'n',
    ylab = 'Treatment Effect',
    xlab = 'Treated Group Distance from Projects',
    xaxt = 'n',
    yaxt = 'n.csv')
abline(h = 0, lty = 2)

# Don't really know what these lines do or the function used to create them.
###draw lines first because I want them to be covered by points
###create spaces in lines using the offset (this allows the N to be displayed with the text() function)
##black lines are offset to the left, white lines to the right    

segments(x0= xs[1:2]+offsets, x1 = xs[1:2]+offsets, ##only do it for low N blacks because otherwise lines look funny
    y0 = use.btreat[,1:2], y1 = use.blower[,1:2])
segments(x0= xs[1:2]+offsets, x1 = xs[1:2]+offsets,
    y0 = use.btreat[,1:2] + line.offset,y1 = use.bupper[,1:2])
##now the others
segments(x0= xs[3:10]+offsets, x1 = xs[3:10]+offsets,
    y0 = use.blower[,3:10], y1 = use.bupper[,3:10])
    
segments(x0= xs-offsets, x1 = xs-offsets, ##bottomlines
    y0 = use.wtreat - line.offset, y1 = use.wlower)
segments(x0= xs-offsets, x1 = xs-offsets, ##toplines
    y0 = use.wtreat, y1 = use.wupper)

##points and N descriptions
# Used for creating the points and counts in black
points(xs-offsets, use.wtreat,
       cex = point.size,
       pch = 21, 
       bg = 'white')
text(xs-offsets,use.wtreat,
     paste('(',use.Nwtreat,')',sep = ''),
     cex = cex.N,
     pos = 1)

# Used for creating the points and counts in black
points(xs+offsets, use.btreat,
       pch = 16,
       cex = point.size)
text(xs+offsets,use.btreat,
     paste('(',use.Nbtreat,')',sep = ''),
     cex = cex.N,
     pos = 3)

# Setting the axis in place
axis(side = 1,
     at = xs,
     label = seq(100,1000,100),
     cex.axis = cex.axis)
axis(side = 2,
     at = ys,
     label = ys.lab,
     cex.axis = cex.axis)
```
Note: Difference-in-differences results for treatment groups defined by increasing distance from the demolished projects. Differences are for the mean turnout in 2004 minus the mean turnout in 2000 for the treatment group minus the same difference for the control group. White circles represent the mean effect on white voters; black circles represent the mean effect on black voters. The N in each treatment group is in parentheses next to the mean effect. Vertical lines represent the 95% confidence intervals generated by bootstrapped standard errors of the difference between treatment and control.

